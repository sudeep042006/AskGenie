# ğŸ¯ Visual Architecture & Data Flow Diagrams

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ASKGENIE SYSTEM ARCHITECTURE                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                â”‚         â”‚                                  â”‚
â”‚        FRONTEND (React)         â”‚         â”‚      BACKEND (Express.js)        â”‚
â”‚                                â”‚         â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       App.jsx            â”‚  â”‚         â”‚  â”‚  apiRoutes.js            â”‚  â”‚
â”‚  â”‚ - State: bots, activeBot â”‚  â”‚         â”‚  â”‚ - POST /chatbot/create   â”‚  â”‚
â”‚  â”‚ - Fetch bots on load     â”‚  â”‚         â”‚  â”‚ - GET /chatbots/:userId  â”‚  â”‚
â”‚  â”‚ - Error handling         â”‚  â”‚         â”‚  â”‚ - POST /chat             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“ renders â†“           â”‚         â”‚           â†“ routes â†“           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Sidebar.jsx              â”‚  â”‚         â”‚  â”‚ crawlController.js       â”‚  â”‚
â”‚  â”‚ - Bot list               â”‚  â”‚         â”‚  â”‚ - createChatbot()        â”‚  â”‚
â”‚  â”‚ - Status badges          â”‚  â”‚         â”‚  â”‚ - getChatbots()          â”‚  â”‚
â”‚  â”‚ - Click to select        â”‚  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚           â†“ uses â†“              â”‚
â”‚           â†“                      â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”‚ chatController.js        â”‚  â”‚
â”‚  â”‚ ChatWindow.jsx           â”‚  â”‚         â”‚  â”‚ - askQuestion()          â”‚  â”‚
â”‚  â”‚ - Message history        â”‚  â”‚         â”‚  â”‚ - getChatHistory()       â”‚  â”‚
â”‚  â”‚ - Send messages          â”‚  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ - Display responses      â”‚  â”‚         â”‚           â†“ uses â†“              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚           â†“                      â”‚         â”‚  â”‚ services/                â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”‚ - crawler.js             â”‚  â”‚
â”‚  â”‚ Hero.jsx                 â”‚  â”‚         â”‚  â”‚ - embedder.js            â”‚  â”‚
â”‚  â”‚ - URL input              â”‚  â”‚         â”‚  â”‚ - llm.js                 â”‚  â”‚
â”‚  â”‚ - Create button          â”‚  â”‚         â”‚  â”‚ - textChunker.js         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                      â”‚         â”‚           â†“ use â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ services/api.js          â”‚  â”‚         â”‚  â”‚ models/                  â”‚  â”‚
â”‚  â”‚ - createBot()            â”‚  â”‚         â”‚  â”‚ - chatbot.js             â”‚  â”‚
â”‚  â”‚ - askQuestion()          â”‚  â”‚         â”‚  â”‚ - chatlog.js             â”‚  â”‚
â”‚  â”‚ - fetchUserBots()        â”‚  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚           â†“ use â†“              â”‚
â”‚           â†“ HTTP calls          â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚ config/                  â”‚  â”‚
                                            â”‚  â”‚ - mongoClient.js         â”‚  â”‚
             axios                          â”‚  â”‚ - supabaseClient.js      â”‚  â”‚
               â†“â†‘                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                Â·                           â”‚           â†“ connect â†“          â”‚
                Â·                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Â·                                        â†“â†‘
                Â·                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  DATABASES & EXTERNAL APIs   â”‚
                                            â”‚                              â”‚
                                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                            â”‚  â”‚ MongoDB              â”‚   â”‚
                                            â”‚  â”‚ - Chatbot collection â”‚   â”‚
                                            â”‚  â”‚ - ChatLog collection â”‚   â”‚
                                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                            â”‚                              â”‚
                                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                            â”‚  â”‚ Supabase (pgvector)  â”‚   â”‚
                                            â”‚  â”‚ - documents table    â”‚   â”‚
                                            â”‚  â”‚ - embeddings (1536)  â”‚   â”‚
                                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                            â”‚                              â”‚
                                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                            â”‚  â”‚ Firecrawl API        â”‚   â”‚
                                            â”‚  â”‚ - Crawl websites     â”‚   â”‚
                                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                            â”‚                              â”‚
                                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                            â”‚  â”‚ Gemini API           â”‚   â”‚
                                            â”‚  â”‚ - Embeddings         â”‚   â”‚
                                            â”‚  â”‚ - LLM responses      â”‚   â”‚
                                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## User Flow: Create & Chat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CREATE CHATBOT FLOW                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER ENTERS URL
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Frontend: App.jsx â†’ handleCreateBot()                      â”‚
  â”‚ POST /api/chatbot/create { url, userId, name }            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Backend: crawlController.js â†’ createChatbot()              â”‚
  â”‚                                                             â”‚
  â”‚ 1. Chatbot.create()                                        â”‚
  â”‚    âœ“ Save to MongoDB (status: 'processing')               â”‚
  â”‚                                                             â”‚
  â”‚ 2. crawlWebsite(url)                                       â”‚
  â”‚    âœ“ Firecrawl extracts website content                   â”‚
  â”‚                                                             â”‚
  â”‚ 3. chunkText()                                             â”‚
  â”‚    âœ“ Split into manageable chunks                          â”‚
  â”‚                                                             â”‚
  â”‚ 4. For each chunk:                                         â”‚
  â”‚    a) generateEmbedding(chunk)                            â”‚
  â”‚       âœ“ Gemini API â†’ 1536-dim vector                      â”‚
  â”‚    b) supabase.insert(documents)                          â”‚
  â”‚       âœ“ Store in Supabase with metadata                   â”‚
  â”‚       âœ“ metadata.chatbot_id = MongoDB._id â† CRITICAL      â”‚
  â”‚                                                             â”‚
  â”‚ 5. Update MongoDB status: 'ready'                          â”‚
  â”‚                                                             â”‚
  â”‚ 6. Return { message, chatbotId, bot }                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Frontend: Receive response                                 â”‚
  â”‚ - Add bot to sidebar                                       â”‚
  â”‚ - Show "Ready" status badge                                â”‚
  â”‚ - Auto-open ChatWindow for new bot                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CHAT & RESPONSE FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER TYPES QUESTION
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Frontend: ChatWindow.jsx â†’ handleSend()                    â”‚
  â”‚ POST /api/chat { question, userId, chatbotId }            â”‚
  â”‚ Display loading state                                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Backend: chatController.js â†’ askQuestion()                 â”‚
  â”‚                                                             â”‚
  â”‚ 1. generateEmbedding(question)                             â”‚
  â”‚    âœ“ Convert question to 1536-dim vector                  â”‚
  â”‚                                                             â”‚
  â”‚ 2. supabase.rpc('match_documents')                         â”‚
  â”‚    âœ“ Vector similarity search                              â”‚
  â”‚    âœ“ Retrieve top 10 most similar chunks                  â”‚
  â”‚    âœ“ Only from THIS chatbot_id â† CRITICAL FILTER          â”‚
  â”‚                                                             â”‚
  â”‚ 3. Build context                                           â”‚
  â”‚    âœ“ Join top chunks with separator                        â”‚
  â”‚                                                             â”‚
  â”‚ 4. Create detailed prompt                                  â”‚
  â”‚    "You are an assistant. Answer using context..."         â”‚
  â”‚                                                             â”‚
  â”‚ 5. generateAnswer(prompt)                                  â”‚
  â”‚    âœ“ Gemini LLM generates response                         â”‚
  â”‚                                                             â”‚
  â”‚ 6. ChatLog.create()                                        â”‚
  â”‚    âœ“ Save question + answer + sources to MongoDB          â”‚
  â”‚                                                             â”‚
  â”‚ 7. Return { answer, sources }                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Frontend: Receive response                                 â”‚
  â”‚ - Add AI message to chat                                   â”‚
  â”‚ - Display answer text                                      â”‚
  â”‚ - Show source links                                        â”‚
  â”‚ - Ready for next question                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Linking: The Critical Connection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHY chatbot_id IN METADATA?                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PROBLEM:
  You have documents in Supabase and bots in MongoDB
  When user asks a question, how do you know which documents belong to which bot?

SOLUTION: chatbot_id in metadata

STEP 1: CREATE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB Chatbot     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: "abc123"       â”‚ â† This is the chatbot_id
â”‚ userId: "user-1"    â”‚
â”‚ url: "example.com"  â”‚
â”‚ status: "ready"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ crawl & embed
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase documents                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: 1                                    â”‚
â”‚ content: "chunk 1"                       â”‚
â”‚ embedding: [0.1, 0.2, ...]               â”‚
â”‚ metadata: {                              â”‚
â”‚   chatbot_id: "abc123"  â† STORED HERE    â”‚
â”‚   url: "example.com"                     â”‚
â”‚   user_id: "user-1"                      â”‚
â”‚ }                                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚ id: 2                                    â”‚
â”‚ content: "chunk 2"                       â”‚
â”‚ embedding: [0.3, 0.4, ...]               â”‚
â”‚ metadata: {                              â”‚
â”‚   chatbot_id: "abc123"  â† STORED HERE    â”‚
â”‚   url: "example.com"                     â”‚
â”‚   user_id: "user-1"                      â”‚
â”‚ }                                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚ id: 3                                    â”‚
â”‚ content: "chunk from ANOTHER bot"        â”‚
â”‚ embedding: [0.5, 0.6, ...]               â”‚
â”‚ metadata: {                              â”‚
â”‚   chatbot_id: "xyz789"  â† DIFFERENT BOT  â”‚
â”‚   url: "another.com"                     â”‚
â”‚   user_id: "user-1"                      â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 2: QUERY
User asks: "Tell me about this site"
Bot: "abc123"

1. Generate embedding for question
2. Find similar documents: [id: 1, id: 2, id: 3, ...all from Supabase]
3. FILTER by chatbot_id === "abc123"
   Results: [id: 1, id: 2]  â† Only these!
4. Build context from [id: 1, id: 2]
5. Generate answer

If you didn't have chatbot_id in metadata:
  - You'd get context from multiple bots mixed together
  - One question might pull from wrong website
  - AI answers would be confused/wrong
```

---

## Message Flow Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MESSAGE EXCHANGE TIMELINE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TIME  â”‚  FRONTEND                    â”‚  BACKEND                 â”‚  DB
â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms   â”‚ User clicks "Create Chatbot" â”‚                          â”‚
      â”‚ URL: example.com             â”‚                          â”‚
      â”‚                              â”‚                          â”‚
5ms   â”‚ POST /chatbot/create         â”‚                          â”‚
      â”‚ {url, userId, name}          â”‚                          â”‚
      â”‚ (show loading spinner)       â”‚                          â”‚
      â”‚                              â”‚                          â”‚
10ms  â”‚                              â”‚ Chatbot.create()         â”‚
      â”‚                              â”‚ status='processing'      â”‚ MongoDB âœ“
      â”‚                              â”‚                          â”‚
50ms  â”‚                              â”‚ crawlWebsite(url)        â”‚
      â”‚                              â”‚ (Firecrawl API)          â”‚ Firecrawl
      â”‚                              â”‚ â†’ [ pages ]              â”‚
      â”‚                              â”‚                          â”‚
200ms â”‚                              â”‚ For each page:           â”‚
      â”‚                              â”‚ - chunkText()            â”‚
      â”‚                              â”‚ - generateEmbedding()    â”‚ Gemini
      â”‚                              â”‚ - supabase.insert()      â”‚ Supabase âœ“
      â”‚                              â”‚                          â”‚
1000msâ”‚                              â”‚ Update MongoDB           â”‚
      â”‚                              â”‚ status='ready'           â”‚ MongoDB âœ“
      â”‚                              â”‚                          â”‚
1010msâ”‚ â† { bot, chatbotId }         â”‚                          â”‚
      â”‚ Add to sidebar               â”‚                          â”‚
      â”‚ Open ChatWindow              â”‚                          â”‚
      â”‚                              â”‚                          â”‚
â”€â”€â”€â”€â”€â”€â”¼â”€ USER STARTS CHATTING â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â”‚                              â”‚                          â”‚
2000msâ”‚ User types question          â”‚                          â”‚
      â”‚ "What services?"             â”‚                          â”‚
      â”‚ Clicks send                  â”‚                          â”‚
      â”‚                              â”‚                          â”‚
2010msâ”‚ Show "Genie is thinking..."  â”‚                          â”‚
      â”‚ POST /chat                   â”‚                          â”‚
      â”‚ {question, userId, chatbotId}â”‚                          â”‚
      â”‚                              â”‚                          â”‚
2020msâ”‚                              â”‚ generateEmbedding()      â”‚ Gemini
      â”‚                              â”‚ question_vec             â”‚
      â”‚                              â”‚                          â”‚
2100msâ”‚                              â”‚ supabase.rpc()           â”‚
      â”‚                              â”‚ match_documents          â”‚ Supabase
      â”‚                              â”‚ â†’ [doc1, doc2, doc3...]  â”‚ âœ“
      â”‚                              â”‚                          â”‚
2110msâ”‚                              â”‚ Filter by chatbot_id     â”‚
      â”‚                              â”‚ â†’ [doc1, doc2]           â”‚
      â”‚                              â”‚                          â”‚
2120msâ”‚                              â”‚ Build context            â”‚
      â”‚                              â”‚ Create detailed prompt   â”‚
      â”‚                              â”‚ generateAnswer()         â”‚ Gemini
      â”‚                              â”‚ â†’ answer text            â”‚
      â”‚                              â”‚                          â”‚
2200msâ”‚                              â”‚ ChatLog.create()         â”‚ MongoDB âœ“
      â”‚                              â”‚ Save Q&A                 â”‚
      â”‚                              â”‚                          â”‚
2210msâ”‚ â† { answer, sources }        â”‚                          â”‚
      â”‚ Display AI response          â”‚                          â”‚
      â”‚ Show source links            â”‚                          â”‚
      â”‚ Clear "thinking" state       â”‚                          â”‚
      â”‚                              â”‚                          â”‚
```

---

## Database Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE RELATIONSHIPS                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MONGODB
â”œâ”€â”€â”€ Collection: chatbots
â”‚    â”œâ”€â”€â”€ Document 1
â”‚    â”‚    â”œâ”€â”€â”€ _id: ObjectId("abc123")  â† PK
â”‚    â”‚    â”œâ”€â”€â”€ userId: "user-1"         â† FK to users (if exists)
â”‚    â”‚    â”œâ”€â”€â”€ url: "example.com"
â”‚    â”‚    â”œâ”€â”€â”€ name: "Example Bot"
â”‚    â”‚    â”œâ”€â”€â”€ status: "ready"
â”‚    â”‚    â””â”€â”€â”€ createdAt: Date
â”‚    â”‚
â”‚    â””â”€â”€â”€ Document 2
â”‚         â”œâ”€â”€â”€ _id: ObjectId("def456")
â”‚         â”œâ”€â”€â”€ userId: "user-1"
â”‚         â”œâ”€â”€â”€ url: "another.com"
â”‚         â”œâ”€â”€â”€ name: "Another Bot"
â”‚         â”œâ”€â”€â”€ status: "processing"
â”‚         â””â”€â”€â”€ createdAt: Date
â”‚
â””â”€â”€â”€ Collection: chatlogs
     â”œâ”€â”€â”€ Document 1
     â”‚    â”œâ”€â”€â”€ _id: ObjectId("msg1")
     â”‚    â”œâ”€â”€â”€ userQuestion: "What is this?"
     â”‚    â”œâ”€â”€â”€ aiAnswer: "This is..."
     â”‚    â”œâ”€â”€â”€ sources: ["example.com/page1", ...]
     â”‚    â””â”€â”€â”€ timestamp: Date
     â”‚
     â””â”€â”€â”€ Document 2
          â”œâ”€â”€â”€ _id: ObjectId("msg2")
          â”œâ”€â”€â”€ userQuestion: "Another question"
          â”œâ”€â”€â”€ aiAnswer: "Answer..."
          â”œâ”€â”€â”€ sources: ["example.com/page2", ...]
          â””â”€â”€â”€ timestamp: Date


SUPABASE (PostgreSQL with pgvector)
â”œâ”€â”€â”€ Table: documents
     â”œâ”€â”€â”€ Row 1
     â”‚    â”œâ”€â”€â”€ id: 1 (PK)
     â”‚    â”œâ”€â”€â”€ content: "chunk text..."
     â”‚    â”œâ”€â”€â”€ embedding: [0.1, 0.2, ...] (1536 dims)
     â”‚    â””â”€â”€â”€ metadata: {
     â”‚         â”œâ”€â”€â”€ chatbot_id: "abc123"   â† FK to MongoDB chatbots._id
     â”‚         â”œâ”€â”€â”€ url: "example.com/p1"
     â”‚         â””â”€â”€â”€ user_id: "user-1"
     â”‚    }
     â”‚
     â”œâ”€â”€â”€ Row 2
     â”‚    â”œâ”€â”€â”€ id: 2
     â”‚    â”œâ”€â”€â”€ content: "another chunk..."
     â”‚    â”œâ”€â”€â”€ embedding: [0.3, 0.4, ...]
     â”‚    â””â”€â”€â”€ metadata: {
     â”‚         â”œâ”€â”€â”€ chatbot_id: "abc123"   â† Same bot
     â”‚         â”œâ”€â”€â”€ url: "example.com/p2"
     â”‚         â””â”€â”€â”€ user_id: "user-1"
     â”‚    }
     â”‚
     â””â”€â”€â”€ Row 3
          â”œâ”€â”€â”€ id: 3
          â”œâ”€â”€â”€ content: "different site chunk..."
          â”œâ”€â”€â”€ embedding: [0.5, 0.6, ...]
          â””â”€â”€â”€ metadata: {
               â”œâ”€â”€â”€ chatbot_id: "def456"   â† Different bot!
               â”œâ”€â”€â”€ url: "another.com/p1"
               â””â”€â”€â”€ user_id: "user-1"
          }


RELATIONSHIPS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB chatbots._id                            â”‚
â”‚ â†“                                               â”‚
â”‚ Supabase documents.metadata.chatbot_id          â”‚
â”‚ (Enables: "Give me all docs for this bot")      â”‚
â”‚                                                 â”‚
â”‚ MongoDB chatlogs (stores question/answer)       â”‚
â”‚ (Could be extended to link to chatbots._id)    â”‚
â”‚                                                 â”‚
â”‚ Frontend userId                                 â”‚
â”‚ â†“                                               â”‚
â”‚ MongoDB chatbots.userId                         â”‚
â”‚ Supabase documents.metadata.user_id             â”‚
â”‚ (Enables: "Get all bots for this user")         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Prop Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     REACT PROP FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

App (Root)
â”œâ”€ State:
â”‚  â”œâ”€ bots: Chatbot[]
â”‚  â”œâ”€ activeBot: Chatbot | null
â”‚  â”œâ”€ userId: string
â”‚  â”œâ”€ loading: boolean
â”‚  â””â”€ error: string | null
â”‚
â”œâ”€ Passes to Navbar (no props)
â”‚
â”œâ”€ Passes to Sidebar:
â”‚  â”œâ”€ bots â†’ { name, url, status }
â”‚  â””â”€ onSelectBot, onNewChat â†’ callbacks
â”‚
â””â”€ Passes to Hero or ChatWindow:
   â”œâ”€ If activeBot === null:
   â”‚  â””â”€ Hero
   â”‚     â””â”€ onCreate(url) â†’ calls handleCreateBot(url)
   â”‚
   â””â”€ If activeBot !== null:
      â””â”€ ChatWindow
         â”œâ”€ chatbot { _id, name, url, status }
         â”œâ”€ userId
         â””â”€ onBack â†’ setActiveBot(null)

COMPONENT HIERARCHY:
App
â”œâ”€â”€ Navbar
â”œâ”€â”€ Sidebar
â”‚   â””â”€ bot cards (clickable)
â”‚      â””â”€ onClick â†’ onSelectBot(bot)
â”‚
â””â”€â”€ Main Area
    â”œâ”€â”€ Hero (when activeBot === null)
    â”‚   â””â”€ onClick â†’ onCreate(url)
    â”‚      â””â”€ App.handleCreateBot(url)
    â”‚         â”œâ”€ API.createBot()
    â”‚         â”œâ”€ setBots([...bots, newBot])
    â”‚         â””â”€ setActiveBot(newBot)
    â”‚
    â””â”€â”€ ChatWindow (when activeBot !== null)
        â”œâ”€ ChatWindow.messages (local state)
        â”‚  â””â”€ handleSend()
        â”‚     â”œâ”€ API.askQuestion(chatbotId, question, userId)
        â”‚     â””â”€ setMessages([...messages, userMsg, aiMsg])
        â”‚
        â””â”€ onBack
           â””â”€ App.setActiveBot(null)
              â””â”€ Renders Hero
```

---

**These diagrams show the complete system architecture, data flow, and component relationships!**
